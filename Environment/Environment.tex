% $Author: oscar $
% $Date: 2009-10-26 05:25:10 -0300 (lun 26 de oct de 2009) $
% $Revision: 29516 $

% HISTORY:
% 2006-10-24 - Pollet started
% 2006-12-09 - Andrew adds material
% 2007-08-30 - Andrew completes first draft
% 2007-08-31 - Oscar edits
% 2007-09-07 - Stef corrections
% 2007-10-08 - Cassou corrections
% 2011-05-20 - NicoPaez started spanish translation
% 2011-06-09 - PPlaza following spanish translation

%=================================================================
\ifx\wholebook\relax\else
% --------------------------------------------
% Lulu:
	\documentclass[a4paper,10pt,twoside]{book}
	\usepackage[
		papersize={6.13in,9.21in},
		hmargin={.75in,.75in},
		vmargin={.75in,1in},
		ignoreheadfoot
	]{geometry}
	\input{../common.tex}
	\pagestyle{headings}
	\setboolean{lulu}{true}
% --------------------------------------------
% A4:
%	\documentclass[a4paper,11pt,twoside]{book}
%	\input{../common.tex}
%	\usepackage{a4wide}
% --------------------------------------------
    \graphicspath{{figures/} {../figures/}}
	\begin{document}
	% \renewcommand{\nnbb}[2]{} % Disable editorial comments
	\sloppy
\fi
%=================================================================
\chapter{El entorno de progamaci\'on Pharo}
\chalabel{env}


El objetivo de este capitulo es mostrar la forma de desarrollar programas en el entorno de programaci\'on \pharo.
Ya se ha visto como definir m\'etodos y clases usando el buscador; este capitulo mostrar\'a m\'as caracteristicas del buscador, e introducir\'a algunos de los dem\'as buscadores.

Por supuesto, ocasionalmente puede suceder que el programa no realice la funci\'on que de \'el se espera. Por ello, \pharo tiene un excelente depurador, pero al igual que otras herramientas poderosas, puede resultar confuso cuando se lo usa por primera vez. En este capitulo se dar\'a un ejemplo de depuraci\'on y se demostrar\'an algunas de las caracter\'isticas de esta herramienta.

Una de las caracter\'isticas \'unicas de Smalltalk es que mientras se est\'a programando, uno pertenece a un mundo de objetos vivos, muy distinto al de los programas est\'aticos. Esto hace posible obtener feedback de forma instantanea mientras se programa, lo cual permite al programador ser m\'as productivo. Hay dos herramientas que permiten analizar, e incluso cambiar, los objetos vivos: el \emph{inspector} y el \emph{explorer}.

La consecuencia de programar en un mundo de objetos vivos, en vez de hacerlo con archivos y un editor de texto, es que se debe realizar una acci\'on explicita para exportar el programa desde la imagen de Smalltalk.
La forma antigua de hacerlo, posible en todos los dialectos Smalltalk, es mediante crear un \emph{fileout} o un \emph{change set}, los cuales son en esencia archivos de texto encriptados que pueden ser importados desde otro sistema.
En cambio, la nueva forma de hacer esto en \pharo is subir el c\'odigo a un repositorio de versiones en un servidor.  Esto se logra usando una herramienta llamada \ind{Monticello}, y es una manera m\'as poderosa y eficiente de trabajar, especialmente en grupo.
\seeindex{change set}{file, filing out}
\index{file!filing out}

%Finally, you may find a bug in \pharo as you work; we explain how to report bugs, and how to submit bug fixes.
%\ab{Or I would, if I knew how.   We should do this, or remove the paragraph.}

%=========================================================
\section{Resumen}
\seclabel{overview}

Smalltalk y las interfaces gr\'aficas modernas fueron desarrolladas juntas.
Aun antes del primer lanzamiento p\'ublico de Smalltalk en 1983, este ten\'ia un entorno gr\'afico de desarrollo auto-alojado, y todo el desarrollo en Smalltalk tomaba lugar en \'el.
Para empezar, se ver\'an las herramientas principales de \pharo.

\begin{itemize}
	\item {El \menu{Browser}} es la principal herramienta de desarrollo. Se usa para crear, definir y organizar las clases y m\'etodos. Usandolo tambien se puede navegar por todas las librer\'ias de clase: a diferencia de otros entornos donde el c\'odigo fuente es almacenado en archivos diferentes, en Smalltalk todas las clases y m\'etodos est\'an contenidos en la imagen.
	\index{browser}

	\item{\menu{Message Names}} se usa para ver todos los m\'etodos con un selector particular, o con uno que contenga una subcadena de caracteres.
	\index{message name finder}
	
	\item{El \menu{Method Finder}} tambi\'en le ayudarÃ¡ a encontr\'ar m\'etodos, pero de acuerdo a lo que \emph{hacen} adem\'as de por su nombre.
	\index{method finder}
	
	\item{El \menu{Monticello Browser}} es el punto de partida para cargar c\'odigo desde, o guardar c\'odigo en, los paquetes \ind{Monticello}.

	\item{El \menu{Process Browser} permite ver todos los procesos (\emph{threads}) que se est\'an ejecutando en Smalltalk.}
	\index{process browser}
	
	\item{El \menu{Test Runner}} le permite correr y debbugear las pruebas \SUnit, y se describe en \charef{SUnit}.
	\index{Test Runner}
	\index{SUnit}
	
	\item{El \menu{Transcript}} es una ventana en el canal de salida del \glbind{Transcript}, el cual es \'util para escribir mensajes de registro y que ya se ha descripto en \secref{transcript}.
	
	\item{El \menu{Workspace}} es una ventana donde se pueden tipear entradas.
	Puede ser usado con cualquier propÃ³sito, pero es m\'as usado para tipear expresiones de Smalltalk y
	ejecutarlas con \menu{do it}. El uso del \ind{workspace} tambi\'en fue ilustrado en \secref{transcript}.

\end{itemize}

El \menu{Debugger} tiene una tarea obvia, pero descubrir\'a que tiene un rol mÃ¡s importante comparado con los debuggers de otros lenguajes de programaci\'on , porque en Smalltalk se puede \emph{programar} en el \ind{debugger}. El debugger no se lanza desde un men\'u; normalmente aparece al correr una prueba que falla, al tipear \short{\textbf{.}} para interrumpir un proceso en curso, o insertando una expreci\'on \ct{self halt} en el c\'odigo.
\index{process!interrupting}

%=========================================================
\section{El Navegador}
\seclabel{browser}

Muchos navegadores de clases diferentes se han desarrollado a trevez de los aÃ±os para \st.
\pharo simplifica esta historia por medio de ofrecer un navegados que integra diversas vistas.
\figref{SystemBrowser0} muestra el navegador como aparece la primera vez que es abierto.\footnote{Recuerde que si el navegador que usted tenga no se ve como el mostrado en \figref{classBrowser}, quiz\'as necesite cambiar el navegador por defecto.  V\'ease \faqref{packagebrowser}.}

\begin{figure}[htbp]
   \centering
   \ifluluelse
	 {\includegraphics[width=\textwidth]{SystemBrowser0} }
	 {\includegraphics[width=0.7\textwidth]{SystemBrowser0} }
   \caption{El Navegador}
   \figlabel{SystemBrowser0}
\end{figure}

Los cuatro paneles pequeÃ±os en la parte superior del navegador representan una visi\'on jer\'arquica de los m\'etodos que se hallan en el sistema, de una manera muy similar a como el \textit{File Viewer} de \ind{NeXTstep} y el \textit{Finder} de Mac OS X en modo de columna, dan una vista de los archivos en el disco.
En el panel que se halla en el extremo ixquierdo se encuentran las listas de los \emph{paquetes} de clases; seleccione uno (por ejemplo \scat{Kernel}) y el panel a la derecha mostrar\'a entonces todas las clases en ese paquete.
% \on{I adopted the spelling of NeXTstep recommended by wikipedia}

\begin{figure}[htbp]
   \centering
   \ifluluelse
	   {\includegraphics[width=\textwidth]{SystemBrowser1} }
	   {\includegraphics[width=.7\textwidth]{SystemBrowser1} }
   \caption{El Navegador con la clase \ct{Model} seleccionada
   \figlabel{SystemBrowserModel}}
\end{figure}

De forma similar, si selecciona una de las clases en el segundo panel, por ejemplo, \menu{Model} (v\'ease \figref{SystemBrowserModel}), el tercer panel mostrar\'a todos los \emph{protocolos} definidos para esa clase, asi como un protocolo virtual \prot{-{}-all-{}-}, que est\'a seleccionado por defecto.
Los protocolos son una forma de categorizar los m\'etodos; hacen m\'as facil hallar y pensar en en el comportamiento de una clase al separarla en piezas m\'as pequeÃ±as y conceptualmente coherentes.
El cuarto panel muestra los nombres de todos los m\'etodos definidos en el protocolo seleccionado.
Si selecciona el nombre de un m\'etodo, el c\'odigo fuente del m\'etodo correspondiente aparece en el panel alergado en la parte inferior del navegador, donde puede verlo, editarlo, y guardar la versi\'on editada.
Si selecciona la clase \menu{Model}, el protocolo \protind{dependents} y el m\'etodo \menu{myDependents}, el navegador deber\'ia verse como en \figref{SystemBrowserMyDependents}.
\protindex{all}
\cmindex{Model}{myDependents}

\begin{figure}[htbp]
   \centering
   \ifluluelse
	   {\includegraphics[width=\textwidth]{SystemBrowserMyDependents}}
	   {\includegraphics[width=0.7\textwidth]{SystemBrowserMyDependents}}
   \caption{El Navegador mostrando el m\'etodo \ct{myDependents} en la clase \ct{Model}
   \figlabel{SystemBrowserMyDependents}}
\end{figure}

A diferencia de los directorios en el \emph{Finder} de Mac OS X, los cuatro paneles superiores no son exactamente iguales.
Mientras que las clases y los m\'etodos son parte del lenguaje Smalltalk, los paquetes y protocolos no lo son: son una comodidad agregada por el navegador para limitar la cantidad de informaci\'on que debe ser mostrada en cada panel. Por ejemplo, si no hubiera protocolos, el navegador tendr\'ia que mostrar una lista de todos los m\'etodos en la clase seleccionada; para muchas clases esta lista ser\'ia muy extensa para ser recorrida convenientemente.
\index{Mac OS X Finder}

Por esta raz\'on, la manera de crear un nuevo paquete o protocolo es diferente de la forma en que se crea una nueva clase o m\'etodo. Para crear un nuevo paquete, haga click en el panel de paquetes y seleccione \menu{new package}; para crear un nuevo protocolo, haga click en el panel de protocolos y seleccione \menu{new protocol}.
Ingrese el nombre de este en el cuadro de dialogo, y est\'a listo: no hay nada m\'as en un paquete o protocolo que su nombre y su contenido.
\index{package!creating}

\begin{figure}[htbp]
   \centering
   \ifluluelse
	   {\includegraphics[width=\textwidth]{SystemBrowserClassCreation}}
	   {\includegraphics[width=0.7\textwidth]{SystemBrowserClassCreation}}
   \caption{El Navegador mostrando la plantilla de creaci\'on de clases
   \figlabel{SystemBrowserClassCreation}}
\end{figure}

Por otro lado, para crear una nueva clase o un nuevo m\'etodo, se deber\'a escribir
cierto c\'odigo Smalltalk. Si hace \click en el paquete
seleccionado(en el panel extremo izquierdo), el panel
inferior del navegador mostrar\'a la plantilla para la creaci\'on de la clase.
(\figref{SystemBrowserClassCreation}).  Se crea una nueva clase al
editar esta plantilla: reemplace \ct{Object} por el nombre de la clase existente
de la cual quiere crear una nueva subclase, reemplace
\ct{NameOfSubclass} por el nombre que desea darle a la nueva
subclase, y complete los nombres de las variables de instancia si los
conoce.  La categor\'ia de la nueva clase es por defecto la del paquete
que est\'e seleccionado\footnote{Recuerde que los paquetes y categor\'ias no son exactamente lo mismo. Se ver\'a la relaci\'on precisa en \secref{packages}}, pero puede cambiar esto tambi\'n si as\'i lo desea.  Si
ya tiene el navegador centrado en la clase de la que desea una
subclase, puede obtener la misma plantilla con unas pequeÃ±as diferencias en la
inicializaci\'on mediante \actclick{ing} en el panel de clase, y
seleccionando \menu{class templates \ldots \go subclass template}.  Tambi\'en puede solo
editar la definici\'on de una clase existente, cambiando el nombre de la clase a
uno nuevo.  En todas las clases, cuando acepta la nueva definici\'on, la
nueva clase (aquella cuyo nombre est\'a a continuacion de \ct{#}) es creada (as\'i como
su correspondiente metaclase).  Crear una clase tambi\'en crea una variable global
que referencia a la clase, que es por lo que uno puede referirse a todas las
clases existentes por medio de usar sus nombres.  \index{class!creation}
\index{browser!defining a class}

Puede ver por qu\'e el nombre de la nueva clase tiene que aparecer como un \clsind{Symbol} (\ie antecedido por \ct{#}) en la plantilla de creaci\'on de la clase, pero despu\'es de que la clase ha sido creada, el c\'odigo puede referirse a la clase mediante usar el nombre como identificador (\ie sin el \ct{#})?

El proceso de creaci\'on de un nuevo m\'etodo es similar. Primero selecciona la clase en la que se desea que exista el m\'etodo, y luego se elige un protocolo.  El navegador mostrar\'a una plantilla de creaci\'on de m\'etodos, como se ve en \figref{SystemBrowserMethodTemplate}, la cual puede completar o editar.
\index{method!creation}
\index{browser!defining a method}

\begin{figure}[htbp]
   \centering
   \ifluluelse
	   {\includegraphics [width=\textwidth]{SystemBrowserMethodTemplate}}
	   {\includegraphics[width=0.7\textwidth]{SystemBrowserMethodTemplate}}
   \caption{El navegador mostrando la plantilla de creaci\'on de m\'etodos
   \figlabel{SystemBrowserMethodTemplate}}
\end{figure}

%---------------------------------------------------------
\subsection{Navegando los espacios de cÃ³digo}

El navegador provee varias herramientas para explorar y analizar cÃ³digo.
Estas herramientas pueden ser accedidas \actclick{ing} en varios de los menÃºes contextuales, o en el caso de las herramientas mÃ¡s frecuentemente usadas, por medio de un shortcut de teclado.\nicopaez{hace falta traducir shorcut??}

\subsubsection{Abriendo un nueva ventana del navegador}
\seclabel{browsing}

El ocasiones, querrÃ¡s abrir mÃºltiples ventanas de explorador.
Cuando estÃ¡s escribiendo cÃ³digo seguramente necesitarÃ¡s al menos dos: una para el mÃ©todo que estÃ¡s escribiendo, y otra para navegar por el sistema para ver como funcionan las cosas.
You can open a browser on a class named by any selected text using the \short{b} \ind{keyboard shortcut}.
\index{browser!browse button}
\index{keyboard shortcut!browse it}

\dothis{Prueba esto: en un workspace, tipea el nombre de una clase (por ejemplo \ct{Morph}), seleccionalo, y presiona \short{b}. Este truco es frecuentemente Ãºtil; funciona en cualquier ventana de texto.}

\subsubsection{Emisores e implementadores de un mensaje}
\seclabel{sendersImplementors}

\index{browser!senders}
\Actclick{ing} \menu{browse \ldots \go senders (n)} en el panel de m\'etodos traer\'a una lista de todos los m\'etodos que puede usar el seleccionado m\'etodo. Con el navegador abierto en \ct{Morph}, haga clic en el m\'etodo \mthind{Morph}{drawOn:} en el panel de m\'etodos; el cuerpo de \ct{drawOn:} se mostrar\'a en la parte inferior del navegador. Si ahora seleccionas \menu{senders (n)} (\figref{SendersOfDrawOn}), aparecer\'a un men\'u con \ct{drawOn:} como el \'item mas alto, y abajo de este, todos los mensajes que \ct{drawOn:} env\'ia (\figref{SendersOfDrawOn2}).  Seleccionando un \'item en este men\'u abrir\'a el navegador con una lista de todos los m\'etodos en la imagen que env\'ia el seleccionado mensaje (\figref{CanvasDraw}).

%\begin{figure}[htb]
%\begin{minipage}[b]{0.74\textwidth}
%\centerline {\includegraphics[width=\textwidth]{SendersOfDrawOn}}
%\caption{The \menu{senders (n)} menu item.\figlabel{SendersOfDrawOn}}
%\end{minipage}
%\hfill
%\begin{minipage}[b]{0.24\textwidth}
%\centerline {\includegraphics[width=\textwidth]{SendersOfDrawOn2}}
%\caption{Choose senders of which message.\figlabel{SendersOfDrawOn2}}
%\end{minipage}
%\end{figure}

\begin{figure}[htb]
\centerline {\includegraphics[width=\textwidth]{SendersOfDrawOn}}
\caption{The \menu{senders (n)} menu item.\figlabel{SendersOfDrawOn}}
\end{figure}

\begin{figure}[htb]
\centerline {\includegraphics[width=0.4\textwidth]{SendersOfDrawOn2}}
\caption{Choose senders of which message.\figlabel{SendersOfDrawOn2}}
\end{figure}

La ``n'' en \menu{senders (n)} te indica que el acceso r\'apido del teclado para encontrar los emisores de un mensaje es \short{n}. Esto trabajar\'a en \emph{cualquier} ventana de texto.

\dothis{Seleccionar el texto ``drawOn:'' en el panel de c\'odigo y presionar \short{n} para inmediatamente traer los emisores de \ct{drawOn:}.}

\begin{figure}[htbp]
	\begin{center}
   \ifluluelse
		{\includegraphics[width=\textwidth]{CanvasDraw}}
		{\includegraphics[width=0.7\textwidth]{CanvasDraw}}
	\end{center}
	\caption{The Senders Browser showing that the \ct{Canvas>>>draw} method sends the \ct{drawOn:} message to its argument.	\figlabel{CanvasDraw}}
\end{figure}

Si est\'as buscando los emisores de \ct{drawOn:} en \ct{AtomMorph>>>drawOn:}, ver\'as que esto es un super \subind{super}{send}.  Por lo tanto sabemos que el m\'etodo que se ejecutar\'a ser\'a en la superclase de \ct{AtomMorph} .  ¿Que clase es esta?  \Actclick ~ \menu{browse \go hierarchy implementors} y ver\'as que esta es \ct{EllipseMorph}.
\index{browser!hierarchy button}

Ahora mire el sexto emisor en la lista, \ct{Canvas>>>draw}, mostrado en la \figref{CanvasDraw}.
Usted puede ver que este m\'etodo env\'ia \ct{drawOn:}para cualquier objeto que se le pasa como un argumento, lo que potencialmente podr\'ia ser una instancia de cualquier clase.
An\'alisis de flujo puede ayudar a entender la clase del receptor de algunos mensajes, pero en general, no existe una manera sencilla para que el navegador pueda saber cual mensaje-env\'ia puede causar que los métodos ser\'an ejecutados.
Por esta raz\'on, los ``senders''en el navegador muestra exactamente lo que sugiere su nombre: todos los emisores de los mensajes con el selector elegido.
El navegador de emisores es sin embargo extremadamente \'util cuando necesitas comprender c\'omo puedes \emph{usar} un m\'etodo: te permite navegar r\'apidamente a trav\'es del ejemplo utilizado.
Dado que todos los m\'etodos con el mismo selector deben usarse de la misma manera, todos los usos de un determinado mensaje tienen que ser similares.
\index{browser!senders}

\index{browser!implementors}
El navegador de los implementadores trabaja de una manera similar, pero en vez del listado de emisores de un mensaje, esto lista todas las clases que implementan un m\'etodo con el mismo selector. Para ver esto, seleccione \lct{drawOn:} en el panel de m\'etodos y seleccione \menu{browse \go implementors (m)} (o seleccione el texto ``drawOn:'' en el panel de c\'odigo y presione \short{m}).
Deber\'ias obtener una ventana con una lista de m\'etodos mostrando una lista desplazable de 90-odd clases que implementa un m\'etodo \ct{drawOn:}.
No deber\'ia ser tan sorprendente que tantas clases implementen este m\'etodo: \ct{drawOn:} es el mensaje que se entiende por cada objeto que es capaz de representarse en la patalla.

\subsubsection{Versiones de un m\'etodo}
\seclabel{versions}

Cuando guardas un nuevo \subind{m\'etodo}{versi\'on} de un m\'etodo, la antigua no se pierde.  \pharo mantiene todas las versiones antiguas, y te permite comparar las diferentes versiones y volver (``revert'') a una versi\'on antigua.
\begin{figure}[btp]
   \centering
   \includegraphics[width=\textwidth]{Versions}
   \caption{The \ind{versions browser} showing two versions of the \ct{TheWorldMenu>>>buildWorldMenu:} method}
   \figlabel{buildWorldMenuVersions}
\end{figure}
El \'item del men\'u \menu{browse \go versions (v)} da acceso a las sucesivas modificaciones introducidas en el método seleccionado.
En \figref{buildWorldMenuVersions} podemos ver dos versiones del m\'etodo \ct{buildWorldMenu:}.

\index{browser!versions button}
El panel superior muestra una l\'inea para cada versi\'on del m\'etodo, en el que fifuran las iniciales del programador que las escribi\'o, la fecha y hora en que se guard\'o, los nombres de la clase y el m\'etodo, y el protocolo en el que se ha definido.  La actual versi\'on (activa) est\'a en la parte superior de la lista; independiente de la versi\'on seleccionada se muestra en la parte inferior del panel.
% Si el checkbox \menu{diffs} esta seleccionado, como lo es en \figref{mouseUpVersions}, la pantalla tambi\'en muestra las diferencias entre la versi\'on seleccionada y el inmediatamente anterior.
También se proporcionan botones para mostrar las diferencias entre el método seleccionado y la versión actual, y para volver a la versión seleccionada.
% El checkbox \menu{prettyDiffs} es \'util si ha habido cambios en el diseño: este imprime muy bonito ambas versiones antes de la diferenciaci\'on, de modo que las diferencias que se observan excluyen los cambios del formato.

La existencia de las \ind{versiones del navegador} significa que nunca tend\'as que preocuparte de preservar el c\'odigo que piensas que tal ves ya no sea necesario: simplemente suprimalo. Si encuentr\'as que lo \emph{necesitas}, siempre puedes volver a la versi\'on anterior, o copiar el fragmento de la versi\'on anterior y pegarlo en otro m\'etodo.
Get into the habit of using versions;  ``comentando'' el c\'odigo que ya no es necesario es una mala pr\'actica porque hace que el actual c\'odigo sea m\'as dif\'icil de leer.
La tasa de legilibilidad de c\'odigo de Smalltalkers es extremadamente alta.

\hint{¿Que pasa si se elimina completamente un m\'etodo?, y luego se decides que deseas recuperarlo?  Puedes encontrar el borrado en un conjunto de cambio, donde puedes pedir ver las versiones por \actclick{ing}.
El conjunto de cambio esta descrito en \secref{env:changeSet}}

\subsubsection{Sobre escribiendo m\'etodos}
\seclabel{overriding}

El navegador de herencia mostrar\'a todos los m\'etodos sobre escritos por el m\'etodo mostrado.
Para ver como trabaja, seleccione el m\'etodo \cmind{ImageMorph}{drawOn:} en el navegador.
Nota el icono triangular pr\'oximo al nombre del m\'etodo (\figref{OBinheritanceBrowser}).
El tri\'angulo que apunta hacia arriba te dice que \ct{ImageMorph>>>drawOn:} sobre escribe un m\etodo heredado (\ie \ct{Morph>>>drawOn:}), y el tri\'angulo apuntando hacia abajo te dice que es sobre escrito por subclases. (Tambi\'en puedes hacer click sobre los iconos para ir a estos m\'etodos.)
Ahora selecciona \menu{browse \go inheritance}.
El navegador de herencia te mostrar\'a la jerarqu\'ia de los m\'etodos sobre escritos (ver \figref{OBinheritanceBrowser}).

\begin{figure}[btp]
	\begin{center}
   \ifluluelse
		{\includegraphics[width=\textwidth]{OBInheritanceOverriding}}
		{\includegraphics[width=0.7\textwidth]{OBInheritanceOverriding}}
	\end{center}
	\caption{\ct{ImageMorph>>>drawOn:} y los m\'etodos que este sobre escribe. Los hermanos de los m\'etodos seleccionados son mostrados en las listas de desplazables.}
	\figlabel{OBinheritanceBrowser}
\end{figure}

\subsubsection{La vista de jerarqu\'ia}
\seclabel{hierarchy}

De forma predeterminada, el navegador presenta una lista de los paquetes en el panel que est\'a m\'as a la izquierda.
Sin embargo, es posible cambiar a una vista de jerarquía de clases.
Simplemente seleccione una clase de particular de inter\'es, tal como  \ct{ImageMorph} y, haga clic en el botón \button{hier.}.
A continuación, podrá ver en el panel que est\'a m\'as a la izquierda una jerarquía de clases mostrando todas las superclases y subclases de la clase seleccionada.
El segundo panel muestra los paquetes que implementan los métodos de la clase seleccionada.
%El bot\'on \button{hierarchy} abre un \ind{navegador de jerarqu\'ia} en la actual clase; este
%navegador puede tambi\'en ser abierto utilizando el \'item del men\'u \menu{browse hierarchy} en el panel de clases.
%El navegador de la jerarqu\'ia es similar al navegador, pero en vez de mostrar las categor\'ias y las clases en cada categor\'ia, muestra una \'unica lista de clases, indentada para representar la jerarqu\'ia.
%La categor\'ia de la seleccionada clase es mostrada en un pequeño panel de comentarios en la parte superior del navegador.
El navegador de jerarqu\'ia \figref{hierarchyBrowser}, revela que la superclase directa de \clsind{ImageMorph} es \clsind{Morph}.
\index{browser!hierarchy button}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{hierarchyBrowser}}
		{\includegraphics[width=0.7\textwidth]{hierarchyBrowser}}
	\end{center}
	\caption{A hierarchy view of \ct{ImageMorph}.}
	\figlabel{hierarchyBrowser}
\end{figure}

\subsubsection{Encontrar las referencias a variables}
\seclabel{variables}

\index{browser!variables}
Por\actclick{ing} en una clase en el panel de clases, y seleccionando \menu{browse \go chase variables}, puedes encontrar donde se utiliza una variable de clase o una variable de instancia.
Se le presentar\'a con un \emph{chasing browser} que le permitir\'a recorrer los descriptores de acceso de todas las variables de instancia y las variables de clases , y, a su vez, los m\'etodos que envian estos descriptores, etc. (\figref{chasingBrowser}).

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{chasingBrowser}}
		{\includegraphics[width=0.7\textwidth]{chasingBrowser}}
	\end{center}
	\caption{Un navegador de seguimiento para \ct{Morph}.}
	\figlabel{chasingBrowser}
\end{figure}

% The menu also includes \menu{inst var defs}, which shows the subset of the instance variable references that assign to the variable.
%Once you click on the button or select the menu item, you will be presented with a dialog that invites you to choose a variable from all of the variables defined in the current class, and all of the variables that it inherits.  The list is in inheritance order; it can often be useful to bring up this list just to remind yourself of the name of an instance variable.  If you click outside the list, it will go away and no variable browser will be created.

%Also available by \actclick{ing} the class pane is \menu{class vars}, which opens an inspector showing the class variables of the current class \emph{and their values}, and \menu{class refs (N)} which displays a list of all of the methods that directly reference the current class.

\subsubsection{Fuente}
\seclabel{sources}

\index{browser!view}
El item del men\'u \menu{various \go view \ldots} disponible por \actclick{ing} en el panel del m\'etodo trae el men\'u ``how to show'', el cual te permite escoger como el navegador mostrar\'a el m\'etodo seleccionado en el panel de fuente. Las opciones incluyen el c\'odigo \menu{fuente}, el c\'odigo fuente \menu{prettyPrint}ed , \menu{byteCode} y el c\'odigo fuente \menu{decompile}d desde los c\'odigos byte.
% The label on the button changes if you select one of the other modes.  There are other options too; if you let the mouse linger over the names, a help balloon will appear.  Try some of them.
\index{method!pretty-print}
\index{method!decompile}
\index{method!byte code}

Tenga en cuenta que seleccionando \menu{prettyPrint} en el men\'u ``how to show'' \emph{no} es lo mismo como el resaltado de sintaxis de un m\'etodo antes de guardarlo \footnote{\menu{pretty print (r)} es el primer \'item en el panel de m\'etodo, o en la mitad hacia abajo en el panel de c\'odigo.}.
Los controles del men\'u solamente como muestra el navegador, y no tiene efecto sobre el c\'odigo almacenado en el sistema.
Esto lo puedes comprobar abriendo dos navegadores, y seleccionando en uno \menu{prettyPrint} y en el otro \menu{source}.
De hecho, focalizando dos navegadores en el mismo m\'etodo y seleccionando en uno \menu{byteCode} y en el otro \menu{decompile} es una buena forma de aprender acerca del conjunto de instrucciones byte-coded de la m\'aquina virtual \pharo.

\subsubsection{Refactorizaci\'on}

Los men\'ues contextuales ofrecen un gran n\'umero de refactorizaciones est\'andares.
Simplemente \actclick en cualquiera de los cuatro paneles para ver las operaciones de refactorizaci\'on actualmente disponibles.
Ver \figref{refactoring}.

La Refactorizaci\'on estubo previamente disponible solamente en un navegador especial llamado navegador de refactorizaci\'on, pero ahora se puede acceder a este desde cualquier navegador.

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{refactoring}}
		{\includegraphics[width=0.7\textwidth]{refactoring}}
	\end{center}
	\caption{Operaciones de Refactorizaci\'on.}
	\figlabel{refactoring}
\end{figure}

%---------------------------------------------------------
\subsection{Los men\'us de navegaci\'on}

Muchas funciones adicionales est\'an disponibles por \actclick{ing} en los paneles del navegador.
Incluso si las etiquetas sobre los \'items del men\'u son los mismos, su \emph{significado} puede ser dependiente del contexto.
Por ejemplo, el panel de paquetes, el panel de clases, el panel de protocolos y el panel de m\'etodos todos tienen un \'item del men\'u \menu{file out}.  Sin embargo, ellas hacen cosas diferentes: del men\'u del panel de paquetes \menu{file out} emerge el paquete completo, del men\'u del panel de clases \menu{file out} emerge la clase completa, del men\'u del panel de protocolos \menu{file out} emerge el protocolo completo, y del men\'u del panel de m\'etodos \menu{file out} emerge solo el m\'etodo mostrado.
Si bien esto puede parecer obvio, puede ser una fuente de confusión para los principiantes.
\index{file!filing in}
\index{file!filing out}

Posiblemente el \'item del men\'u mas \'util es \menu{find class\ldots (f)} en el panel de packetes.  Aunque las categor\'ias son \'utiles para el c\'odigo que estamos desarrollando activamente, la mayor\'ia de nosotros no sabemos la categorizaci\'on de todo el sistema, y es mucho mas r\'apido escribir \short{f} seguido por los primeros caracteres del nombre la clase que adivinar cual paquete podr\'ia estar adentro.  \menu{recent classes\ldots} tambi\'en puede ayudarte a volver r\'apidamente a una clase por la cual se ha navegado recientemente, incluso si haz olvidado su nombre.
\index{class!finding}
\index{class!recent}

Tambí\'en puedes buscar una clase o m\'etodo espec\'ifico tecleando el nombre en el recuadro de b\'usqueda en el cuadro superior izquierdo del navegador. Cuando presiones return, una consulta ser\'a puesta en el sistema, y los resultados de la consulta ser\'an mostrados.  Tenga en cuenta que anteponiendo su con sulta con \ct{#}, puedes buscar las referencias a una clase o emisores de un mensaje.
%To browse to a particular method, you can
%In the class pane, there are two menu items \menu{find method} and \menu{find method wildcard\ldots} that can be useful if you want to browse a particular method.
Si est\'as buscando un m\'etodo en particular de la clase seleccionada, es a menudo mas r\'apido it is often quicker to browse the \prot{-{}-all-{}-} protocol (que es el valor predeterminado), coloque el mouse en el panel del m\'etodo, y escriba la primera letra del nombre del m\'etodo que est\'as buscando.
Esto usualmente desplazar\'a el panel de modo que la b\'usqueda del nombre del m\'etodo sea visible.
\index{method!finding}
\protindex{all}

\dothis{Trate de navegar en ambas formas para \cmind{OrderedCollection}{removeAt:}}

Hay muchas otras opciones disponibles en los menúes. Por eso es mejor pasar unos minutos trabajando con el navegador y ver lo que hay.

\dothis{Compare el resultado de \menu{Browse Protocol}, \menu{Browse Hierarchy}, y \menu{Show Hierarchy} en el men\'u del panel de clases.}

%---------------------------------------------------------
\subsection{Navegar mediante programaci\'on}

La clase \glbind{SystemNavigation} proporciona una serie de m\'etodos de utilidad que son \'utiles para navegar por el sistema.
Muchas de las funciones ofrecidas por el cl\'asico navegador son implementadas por \ct{SystemNavigation}.
\index{browsing programmatically}

\dothis{
Abrir un espacio de trabajo y evaluar el siguiente c\'odigo para navegar por los emisores de \ct{drawOn:}:}
\begin{code}{}
SystemNavigation default browseAllCallsOn: #drawOn:
\end{code}
Para restringir la b\'usqueda de los remitentes a los m\'etodos de una clase espec\'ifica:
\begin{code}{}
SystemNavigation default browseAllCallsOn: #drawOn: from: ImageMorph
\end{code}
Debido a que las herramientas de desarrollo son objetos, que son completamente accesibles desde programas, puedes desarrollar tus propias herramientas o adaptar las herramientas existentes para tus necesidades.

El equivalente en programaci\'on al nem\'u \menu{implementors} es:
\begin{code}{}
SystemNavigation default browseAllImplementorsOf: #drawOn:
\end{code}

Para conocer más acerca de lo que está disponible, explorar la clase \ct{SystemNavigation} con el navegador.
Adicionales ejemplos de navegaci\'on pueden ser encontrados en las preguntas frecuentes FAQ (\appref{faq}).

%=========================================================
\section{Monticello}

Hemos dado un r\'apido repaso de \ind{Monticello}, el paquete de herramientas de \pharo, en \secref{Monticello}.
Sin embargo, Monticello tiene muchas mas caracter\'isticas que se han discutido.
Debido a que Monticello administra \emph{paquetes}, Antes de hablarles más acerca de Monticello, es importante que expliquemos primero exactamente lo que es un \ind{paquete} .

%---------------------------------------------------------
\subsection{Packages: declarative categorization of \pharo code}\seclabel{packages}

Hemos señalado anteriormente, en \secref{categoriesPackages} los paquetes que son m\'as o menos equivalentes a las categor\'ias. Ahora vamos a ver exactamente cu\'al es la relaci\'on.
El sistema de paquetes es un sencilla y simple manera de organizar el c\'odigo fuente smalltalk que explota una simple convenci\'on de nombres para las categor\'ias y protocolos.

Veamos esto utilizando un ejemplo.
Suponga que est\'a desarrollando un framework denominado con el fin de facilitar la utilización de bases de datos relacionales de \pharo. Han decidido llamar al framework \ct{PharoLink}, y han creado una serie de categor\'ias que contienen todad las clases que se han escrito, \ej
categor\'ia \ct{'PharoLink-Connections'} contiene \ct{OracleConnection MySQLConnection PostgresConnection} y categor\'ia \ct{'PharoLink-Model'} contiene \ct{DBTable DBRow DBQuery}, etc. Sin embargo, no todo el c\'odigo residir\'a en estas clases. Por ejemplo, tambi\'en puede tener una serie de m\'etodos para convertir objetos en un formato amistoso de SQL:

\begin{code}{}
Object>>>asSQL
String>>>asSQL
Date>>>asSQL
\end{code}

\noindent
Estos paquetes pertenecen a
% \damien{don't we say 'belong to'?}
% \on{no -- belong in = they should be there; belong to = they are there}
los mismos paquetes como las clases en las
categor\'ias \ct{PharoLink-Connections} y \ct{PharoLink-Model}.
Pero es evidente que el conjunto completo de la clase \ct{Object} no pertenece a tu paquete!
Por lo tanto necesitas una manera de poner ciertos \emph{m\'etodos} en un paquete, aunque el resto de la clase est\'a en otro paquete.
\index{package!extension}
\seeindex{extension package}{package, extension}

La manera en que lo haces es poniendo esos m\'etodos en un protocolo  (of \ct{Object}, \ct{String}, \ct{Date}, y as\'i sucesivamente) llamado \prot{*PharoLink} (nota el primer asterisco). La combinaci\'on de las categor\'ias \scat{PharoLink-\ldots} y los protocolos \prot{*PharoLink} forman un paquete denominado \ct{PharoLink}.
Para ser más precisos, las normas de lo que va en un paquete son de la siguiente manera.

Un paquete llamado \ct{Foo} contiene:

\begin{enumerate}		\seclabel{packageRules}
	\item{} todas las \emph{definiciones de la clase} de las clases en la categor\'ia \scat{Foo}, o en las categor\'ias que comienzan con \scat{Foo-}, y
	\item{} \label{env:extensions} todos los \emph{m\'etodos} en \emph{cualquier clase} en los protocolos llamados \prot{*Foo} o \prot{*foo}\footnote{Al realizar esta comparaci\'on, el tamaño de las letras en los nombres es ignorado.}, o cuyo nombre comience con \prot{*Foo-} or \prot{*foo-}, y
	\item{} todos los \emph{m\'etodos} en las clases de la categor\'ia \scat{Foo}, o en la categor\'ia cuyo nombre comience con \scat{Foo-}, \emph{excepto} para esos nombres en los protocolos cuyos nombres comienzan con \prot{*}.
	
\end{enumerate}
\noindent
Una consecuencia de estas reglas es que cada definici\'on de clase y cada método pertenece a exactamente un paquete. La \emph{excepci\'on} en la \'ultima regla ha de estar all\'i porque esos m\'etodos deben pertenecer a otros paquetes. La raz\'on para ignorar el tamaño en la regla \ref{env:extensions} es que, por convenci\'on, los nombres de los protocolos son normalmente (pero no necesariamente) nim\'usculas (y puede incluir espacios), mientras los nombres de las categor\'ias usan CamelCase (y no incluyen espacios).
\index{camelCase}

La clase \ct{PackageInfo} implementa estas reglas, y una manera de tener una sensaci\'on de ellos es experimentar con esta clase.

\dothis{Eval\'ue la siguiente expresi\'on en un workspace:}

\begin{code}{}
mc := PackageInfo named: 'Monticello'
\end{code}

Ahora es posible mirar al interior de este paquete.
Por ejemplo, imprimiendo \ct{mc classes} en el panel del workspace pane devolver\'a una larga lista de clases que componen el paquete de Monticello.
\ct{mc coreMethods}
devolver\'a una lista de \ct{MethodReference}s para todos los m\'etodos en esas clases. \ct{mc extensionMethods} es quiz\'as una de las m\'as interesantes consultas: esta devolver\'a una lista de todos los m\'etodos contenidos en el paquete \ct{Monticello} pero no contenido dentro de una clase \lct{Monticello}.

Los paquetes son una adici\'on relativamente nueva a \pharo, pero ya que las convenciones de nombres de paquetes se basaron en los que estaban en uso, es posible usar \ct{PackageInfo} para analizar c\'odigo m\'as antiguo que no ha sido expl\'icitamente adaptado para trabajar con \'el.

\dothis{Print \ct{(PackageInfo named: 'Collections') externalSubclasses}; esta expresi\'on responder\'a con una lista de todas las subclases de  \ct{Collection} que \emph{no} est\'an en el paquete \ct{Collections}. }

%---------------------------------------------------------
\subsection{Monticello b\'asicos}

\ind{Monticello} debe su nombre al hogar de Thomas Jefferson, una mansi\'on neocl\'asica constru\'iada en la cima de una montaña, tercer presidente de los Estados Unidos y autor del Estatuto de libertad Religiosa de Virginia. El nombre significa ``mont\'iculo'' en Italiano, y por lo tanto, se pronuncia siempre con una ``c'' italiana, que suena como el ``ch'' en chair: Mont-y'-che-llo.


\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{freshMonticello}}
		{\includegraphics[width=0.7\textwidth]{freshMonticello}}
	\end{center}
	\caption{El navegador de Monticello.}
	\figlabel{freshMonticello}
\end{figure}

Al abrir el navegador de Monticello, ver\'as dos paneles de lista y una fila de botones, como se muestra en \figref{freshMonticello}.
El panel de la izquierda muestra una lista de todos los paquetes que han sido cargados en la imagen que est\'as ejecutando; la versi\'on particular del paquete se muestra entre par\'entesis despu\'es del nombre.

El panel de la derecha muestra una lista de todos los repositorios de c\'odigo fuente que Monticello tiene conocimiento, usualmente porque se ha cargado el c\'odigo desde ellos.  Si seleccionas un paquete en el panel de la izquierda, el panel de la derecha se filtra para mostrar \'unicamente los repositorios que contienen las versiones del paquete seleccionado.

Uno de los repositorios es un directorio llamado \emph{package-cache}, el cual es un subdirectorio del directorio en el cual est\'as corriendo la imagen.
Cuando cargas el c\'odigo desde o escribes c\'odigo a un repositorio remoto, una copia es guardada en el cache del paquete. Esto puede ser \'util si la red no esta disponible y necesitas acceder a un paquete.  Tambi\'en, si le das un archivo Monticello (.mcz) directamente, por ejemplo como un archivo adjunto al correo electrónico, la forma m\'as conveniente de acceder a este es colocarlo en el directorio del package-cache.
\index{package!cache}

Para agregar un nuevo repositorio a la lista, clic en el \button{+Repository}, y elegir el tipo de repositorio en el men\'u emergente.  Vamos a agregar un repositorio HTTP.

\dothis{Open Monticello, click on \button{+Repository}, and select \menu{HTTP}.
Editar el di\'alogo para leer:}
%\ab{How does one continue the $\backslash$dothis to include the code?}
%\on{Don't.  Just close the \dothis{} and follow with the code.}
\needlines{4}
\begin{code}{}
MCHttpRepository
	location: 'http://squeaksource.com/PharoByExample'
	user: ''
	password: ''
\end{code}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=0.7\textwidth]{SqueakSource-PBE}}
		{\includegraphics[width=0.7\textwidth]{SqueakSource-PBE}}
	\end{center}
	\caption{Un navegador de Repositorio.}
	\figlabel{SqueakSource:PBE}
\end{figure}
\noindent
Entonces cic en \button{Open} para abrir el navegador de repositorios en este directorio.  Dever\'ias ver algo como \figref{SqueakSource:PBE}.  A la izquierda hay una lista de todos los paquetes en el repositorio; si seleccionas uno, y luego el panel de la derecha se mostrar\'an todas las versiones del paquete seleccionado en este repositorio.

Si haz seleccionado una de las versiones, puedes usar el bot\'on \button{Browse} (sin cargarlo en tu imagen), bot\'on \button{Load} , o buscar con el bot\'on \button{Changes} que se har\'an a su imagen por la carga de la versión seleccionada. Puedes tambi\'en hacer una \button{Copy} de la versión del paquete, que luego puedes escribir en otro repositorio.

Como puedes ver, los nombres de las versiones contienen el nombre del paquete, las iniciales del autor de la versión, y un n\'umero de versi\'on.  El nombre de la versi\'on es tambi\'en el nombre del archivo en el repositorio.  Nunca se deben cambiar estos nombres; la correcta operaci\'on de Monticello depende de ellos!   Los archivos de versiones Monticello son solo archivos zip, y si eres curioso puedes descomprimirlos con una herramienta zip, pero la mejor manera de mirar su contenido es usando el mismo Monticello.

Para crear un paquete con Monticello, tienes que hacer dos cosas: escribir alg\'un c\'odigo, y decile a Monticello acerca de esto.

\dothis{Crear un paquete llamado \scat{PBE-Monticello}, y poner un par de clases en este, como se muestra en \figref{MCnewcategory}.  Tambi\'en, crear un m\'etodo en una existente clase, tal como \ct{Object}, y ponerlo en el mismo paquete como sus clases, usando las reglas de la p\'agina \pageref{sec:packageRules}\,---\,ver \figref{MCnewmethod}.}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{MCnewcategory}}
		{\includegraphics[width=0.7\textwidth]{MCnewcategory}}
	\end{center}
	\caption{Dos clases en el paquete ``PBE''.}
	\figlabel{MCnewcategory}
\end{figure}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{MCnewmethod}}
		{\includegraphics[width=0.7\textwidth]{MCnewmethod}}
	\end{center}
	\caption{Una extensi\'on del m\'etodo que tambi\'en est\'a en el paquete ``PBE''.}
	\figlabel{MCnewmethod}
\end{figure}

Para decirle a Monticello acerca de tus paquetes, clic en el bot\'on \button{+Package}, y escriba el nombre del paquete, en este caso ``PBE''.  Monticello agregar\'a \ct{PBE} a su lista de paquetes; la entrada del paquete ser\'a marcada con un asterisco para mostrar que la versi\'on en la imagen todav\'ia no se ha escrito a cualquier repositorio. Tenga en cuenta que ahora deber\'as tener dos paquetes en Monticello, uno llamado \ct{PBE} y el otro llamado \ct{PBE-Monticello}. Esto esta bien, porque \ct{PBE} contendr\'a \ct{PBE-Monticello}, y otros paquetes a partir de \ct{PBE-}.

Inicialmente, el \'unico repositorio asociado con este paquete ser\'a su cache paquete, como se muestra en \figref{MC+PBE}.  Esto esta bien: todav\'ia puedes guardar el c\'odigo, lo que causar\'a que se escriba el la cach\'e del paquete.
Simplemente haz clic en el bot\'on \button{Save} y ser\'as invitado a proporcionar un registro de la versión del paquete que est\'as a punto de guardar, como se muestra en \figref{PBE-on}; cuando aceptas el mensaje, Monticello guardar\'a tu paquete.
Para indicar esto, el asterisco decorando el nombre en el paquete en el panel de Monticello ser\'a eliminado, y se agregar\'a el n\'umero de la versí\'on.

Si a continuación haces un cambio en el paquete\,---\, por ejemplo agregando un m\'etodo a una de las clases\,---\, el asterisco volver\'a a aparecer, mostrando que tienes cambios que no han sido guardados.  Si abres un navegador de repositorio en el cach\'e de paquetes, puedes seleccionar la versi\'on guardada, y usar el bot\'on \button{Changes} y otros botones.
Tambi\'en puedes por su puesto guardar la nueva versión al respositorio; una vez que refrescada con el bot\'on \button{Refresh} la vista del repositorio, este deber\'ia verse como \figref{package-cache-browser}.
\index{package!cache}

\begin{figure}[tbp]
	\begin{center}
		\includegraphics[width=\textwidth]{MC+PBE}
	\end{center}
	\caption{El paquete PBE a\'un no guardado en Monticello.}
	\figlabel{MC+PBE}
\end{figure}

\begin{figure}[tbp]
	\begin{center}
	\includegraphics[width=0.8\textwidth]{PBE-on}
	\end{center}
	\caption{Entregando un registro de mensaje para una nueva versi\'on de un paquete.}
	\figlabel{PBE-on}
\end{figure}

\begin{figure}[tbp]
	\begin{center}
	\includegraphics[width=\textwidth]{package-cache-browser}
	\end{center}
	\caption{Dos versiones de nuestro paquete est\'an ahora en el cach\'e del paquete.}
	\figlabel{package-cache-browser}
\end{figure}

Para guardar el nuevo paquete de un repositorio que no sea el cach\'e de paquetes, es necesario que te asegures primero que Monticello sabe sobre repositorio, agrega\'andolo si es necesario.
Entonces cuando usas el bot\'on \button{Copy} en el navegador de repositorio de paquetes-cach\'e, y seleccionas el repositorio al cual el paquete deber\'ia ser copiado.
Tambi\'en puedes asociar el repositorio deseado con el paquete  \actclick{ing} en el repositorio y seleccionando \menu{add to package \ldots}, como se muestra en \figref{associateRepository}.
Una vez que el paquete sabe acerca de un repositorio, puedes guardar una nueva versi\'on seleccionando el repositorio y el paquete en el navegador de Monticello, y dando un clic en el bot\'on \button{Save}.
Por supuesto , debes tener permiso para escribir a un repositorio.
El repositorio \ct{PharoByExample} en \emphind{\sqsrc} puede le\'ido por cualquier usuario pero no modificado, si tratas de guardar all\'i, recibir\'as un mensaje de error.
Sin embargo, puedes crear tu propio repositorio en \sqsrc usando la interface web en \url{http://www.squeaksource.com}, y usar esta para guardar tu trabajo.
Esto es especialmente \'util como un mecanismo para compartir tu c\'odigo con amigos, o si usas m\'ultiples computadores.

\begin{figure}[tbp]
	\begin{center}
		\includegraphics[width=\textwidth]{MCaddToPackage}
	\end{center}
	\caption{Agregando un repositorio al conjunto de repositorios asociados con el paquete.}
	\figlabel{associateRepository}
\end{figure}

Si tratas de guardar a un repositorio donde no tienes permiso de escritura, una versi\'on se escribir\'a al cach\'e-paquete de todas maneras.
As\'i puedes recuperar mediante la edici\'on de la informaci\'on del repositorio (\actclick en el navegador Monticello ) o escogiendo un diferente repositorio, y entonces usando el bot\'on \button{Copy} desde el navegador cach\'e-paquete.

%=========================================================
\section{The Inspector and the Explorer}
\seclabel{inspector} % (fold)

One of the things that makes \st so different from many other programming environments is that it is provides you with a window onto a world of live objects, not a world of static code.
Any of those objects can be examined by the programmer, and even changed\,---\,although some care is necessary when changing the basic objects that support the system.
By all means experiment, but save your image first!

%---------------------------------------------------------
\subsection{The Inspector}

\dothis{As an illustration of what you can do with an \ind{inspector}, type  \ct{TimeStamp now} in a workspace, and then \actclick and choose \menu{inspect it}.}
(It's not necessary to select the text before using the menu; if no text is selected, the menu operations work on the whole of the current line.
You can also type \short{i} for \menu{\textbf{i}nspect it}.)
\clsindex{TimeStamp}
\index{keyboard shortcut!inspect it}

\begin{figure}[btp]
	\begin{center}
		\includegraphics[width=\textwidth]{inspectTimeNow1}
	\end{center}
	\caption{Inspecting \ct{TimeStamp now}}
	\figlabel{inspectTimeNow1}
\end{figure}

A window like that shown in \figref{inspectTimeNow1} will appear.
This is an inspector, and can be thought of as a window onto the internals of a particular object\,---\,in this case, the particular instance of \mbox{\ct{TimeStamp}}
% the \mbox is here because without it, the listings macros puts a space between TimeStamp
% and the following word, and that space happens to come out at the start of a line.
that was created when you evaluated the expression \ct{TimeStamp now}.
The title bar of the window shows the printable representation of the object that is being inspected.
If you select \menu{self} at the top of the left pane, the right pane will show the printstring of the object.
% If you select \menu{all inst vars} in the left pane, the right pane will show a list of the instance variables in the object, and the printstring for each one.
% The remaining items in the left pane represent the instance variables; this makes it easy to examine them one at a time, and also to change them.
The left pane shows a tree view of the object, with \self at the root.
Instance variables can be explored by expanding the triangles next to their names.

The horizontal pane at the bottom of the inspector is a small workspace window.  It is useful because in this window, the pseudo-variable \ct{self} is bound to the object that you have selected in the left pane.
So, if you \menu{inspect it} on
\begin{code}{}
self - TimeStamp today
\end{code}
in the workspace pane, the result will be a \clsind{Duration} object that represents the time interval between midnight today and the instant at which you evaluated  \ct{TimeStamp now} and created the \ct{TimeStamp} object that you are inspecting.
You can also try evaluating \ct{TimeStamp now - self}; this will tell you how long you have spent reading this section of this book!

In addition to \ct{self}, all the instance variables of the object are in scope in the workspace pane, so you can use them in expressions or even assign to them.  For example, if you select the root object in the left pane and evaluate \ct{jdn  := jdn - 1} in the workspace pane, you will see that the value of the \ct{jdn} instance variable will indeed change, and the value of \ct{TimeStamp now - self} will increase by one day.

% ON: Does not work anymore
%You can change instance variables directly by selecting them, replacing the old value in the right-hand  pane by a \pharo expression, and accepting.
%\pharo will evaluate the expression and assign the result to the instance variable.

There are special variants of the inspector for Dictionaries, OrderedCollections, CompiledMethods and a few other classes that make it easier to examine the contents of these special objects.

%---------------------------------------------------------
\subsection{The Object Explorer}

The \emph{object explorer} is conceptually similar to the inspector, but presents its information in a different way.
To see the difference, we'll \emph{explore} the same object that we were just inspecting.

\begin{figure}[tbp]
\begin{minipage}{0.48\textwidth}
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{exploreTimeStampNow}}
		{\includegraphics[width=0.7\textwidth]{exploreTimeStampNow}}
	\end{center}
	\caption{Exploring \ct{TimeStamp now}}
	\figlabel{exploreTimeStampNow}
\end{minipage}
\hfill
\begin{minipage}{0.48\textwidth}
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{exploreTimeStampNow2}}
		{\includegraphics[width=0.7\textwidth]{exploreTimeStampNow2}}
	\end{center}
	\caption{Exploring the instance variables}
	\figlabel{exploreTimeStampNow2}
\end{minipage}
\end{figure}

\dothis{Select \menu{self} in the inspector's left-hand pane, then \actclick and choose \menu{explore (I)}.}
The \ind{explorer} window looks like \figref{exploreTimeStampNow}.
If you click on the small triangle next to \ct{root}, the view will change to \figref{exploreTimeStampNow2}, which shows the instance variables of object that you are exploring.
Click on the triangle next to \ct{offset}, and you will see \emph{its} instance variables.
The explorer is really useful when you need to explore a complex hierarchic structure\,---\,hence the name.
\index{keyboard shortcut!explore it}

The workspace pane of the object explorer works slightly differently from that of the inspector.
\ct{self} is not bound to the root object, but rather to the object that is currently selected; the instance variables of the selected object are also in scope.

To see the value of the explorer, let's use it to explore a deeply-nested structure of objects.

\dothis{Evaluate \ct{Object explore} in a workspace.}
This is the object that represents the class \ct{Object} in \pharo.
Note that you can navigate directly to the objects representing the method dictionary and even the compiles methods of this class (see \figref{ExploreObject}).

\begin{figure}[tbp]
	\begin{center}
		\includegraphics[width=0.5\textwidth]{ExploreObject}
	\end{center}
	\caption{Exploring a \ct{ExploreObject}}
	\figlabel{ExploreObject}
\end{figure}

%\dothis{Open a browser, and \metaclick five times on the method pane to bring-up the Morphic halo on the \ct{OBPluggableListMorph} that is used to represent the list of messages.
%Click on the \emph{debug} handle \debugHandle{} and select \menu{explore morph}
%from the menu that appears.  This will open an Explorer on the \clsind{OBPluggableListMorph} object that represents the method list on the screen.
%Open the root object (by clicking in its triangle), open its \ct{submorphs}, and continue exploring the structure of the objects that underlie this Morph, as shown in \figref{explorePluggableListMorph}.}
%
%\begin{figure}[tbp]
%	\begin{center}
%		\includegraphics[width=0.7\textwidth]{explorePluggableListMorph}
%	\end{center}
%	\caption{Exploring a \ct{PluggableListMorph}}
%	\figlabel{explorePluggableListMorph}
%\end{figure}

%=========================================================
\section{The Debugger}
\seclabel{debugger} % (fold)

The \ind{debugger} is arguably the most powerful tool in the \pharo tool suite.  It is used not just for debugging, but also for writing new code.
To demonstrate the debugger, let's start by creating a bug!

\dothis{Using the browser, add the following method to the class \ct{String}:}

\needlines{7}
\begin{method}[buggy]{A buggy method}
suffix
	"assumes that I'm a file name, and answers my suffix, the part after the last dot"
	| dot dotPosition |
	dot := FileDirectory dot.
	dotPosition := (self size to: 1 by: -1) detect: [ :i | (self at: i) = dot ].
	^ self copyFrom: dotPosition to: self size
\end{method}

Of course, we are sure that such a trivial method will work, so instead of writing an SUnit test, we just type
\ct{'readme.txt' suffix} in a workspace and \menu{print it (p)}.
What a surprise!  Instead of getting the expected answer \ct{'txt'}, a \clsind{PreDebugWindow} pops up, as shown in \figref{PreDebugWindow}.

\begin{figure}[btp]
	\begin{center}
	\includegraphics[width=0.8\textwidth]{PreDebugWindow}
	\end{center}
	\caption{A \ct{PreDebugWindow} notifies us of a bug.}
	\figlabel{PreDebugWindow}
\end{figure}

The \ct{PreDebugWindow} has a title-bar that tells us what error occurred, and shows us a \emphind{stack trace} of the messages that led up to the error.
Starting from the bottom of the trace, \ct{UndefinedObject>>>DoIt} represents the code that was compiled and run when we selected \ct{'readme.txt' suffix} in the workspace and asked \pharo to \menu{print it}.
This code, of course, sent the message \ct{suffix} to a \clsind{ByteString} object (\ct{'readme.txt'}).
This caused the inherited \ct{suffix} method in class \ct{String} to execute; all this information is encoded in the next line of the stack trace, \ct{ByteString(String)>>>suffix}.
Working up the stack, we can see that \ct{suffix} sent \ct{detect:}\ldots and eventually \ct{detect:ifNone} sent \ct{errorNotFound}.
\clsindex{UndefinedObject}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{debuggerDetectIfNone}}
		{\includegraphics[width=0.7\textwidth]{debuggerDetectIfNone}}
	\end{center}
	\caption{The debugger.}
	\figlabel{debuggerDetectIfNone}
\end{figure}

To find out \emph{why} the dot was not found, we need the debugger itself, so click on \button{Debug}.

%\dothis{You can also open the debugger by clicking on any of the lines on the stack trace.  If you do this, the debugger will open already focussed on the corresponding method.}

The debugger is shown in \figref{debuggerDetectIfNone}; it looks intimidating at first, but it is quite easy to use.
The title-bar and the top pane are very similar to those that we saw in the \lct{PreDebugWindow}.
However, the debugger combines the stack trace with a method browser, so when you select a line in the stack trace, the corresponding method is shown in the pane below.
It's important to realize that the execution that caused the error is still in your image, but in a suspended state.
Each line of the stack trace represents a frame on the execution stack that contains all of the information necessary to continue the execution.  This includes all of the objects involved in the computation, with their instance variables, and all of the temporary variables of the executing methods.

In \figref{debuggerDetectIfNone} we have selected the \ct{detect:ifNone:} method in the top pane.
The method body is displayed in the center pane; the blue highlight around the message \ct{value} shows that the current method has sent the message \ct{value} and is waiting for an answer.

The four panes at the bottom of the debugger are really two mini-inspectors (without workspace panes).
The inspector on the left shows the current object, that is, the object named \self in the center pane.
As you select different stack frames, the identity of \self may change, and so will the contents of the
\self{}-inspector.
If you click on \self in the bottom-left pane, you will see that \self is the interval \ct{(10 to: 1 by -1)}, which is what we expect.
The workspace panes are not needed in the debugger's mini-inspectors because all of the variables are also in scope in the method pane; you should feel free to type or select expressions in this pane and evaluate them.
You can always \menu{cancel (l)} your changes using the menu or \short{\textit{l}}.
% apb: that lower-case-L is in italics so that it doesn't look like a 1 or a |
\index{keyboard shortcut!cancel}

The inspector on the right shows the temporary variables of the current context.
In \figref{debuggerDetectIfNone},
\ct{value} was sent to the parameter \ct{exceptionBlock}.

%\dothis{To see the current value of this parameter, click on \ct{exceptionBlock} in the context inspector.
%This will tell you that \ct{exceptionBlock} is \ct{[self errorNotFound: ...]}.
%\on{no longer true!}

As we can see one method lower in the stack trace, the \ct{exceptionBlock} is \ct{[self errorNotFound: ...]}, so, it is not surprising that we see the corresponding error message.

Incidentally, if you want to open a full inspector or explorer on one of the variables shown in the mini-inspectors, just double-click on the name of the variable, or select the name of the variable and \actclick to choose \menu{inspect (i)} or \menu{explore (I)}.
This can be useful if you want to watch how a variable changes while you execute other code.
\index{keyboard shortcut!inspect it}
\index{keyboard shortcut!explore it}

Looking back at the method window, we see that we expected the penultimate line of the method to find \ct{dot} in the string \ct{'readme.txt'}, and that execution should never have reached the final line.
\pharo does not let us run an execution backwards, but it does let us start a method again, which works very well in code such as this that does not mutate objects, but instead creates new ones.

\dothis{Click \button{Restart}, and you will see that the locus of execution returns to the first statement of the current method.
The blue highlight shows that the next message to be sent will be {\ct{do:}} (see \figref{RestartDetectIfNone}).}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{RestartDetectIfNone}}
		{\includegraphics[width=0.7\textwidth]{RestartDetectIfNone}}
	\end{center}
	\caption{The debugger after restarting the \ct{detect: ifNone:} method}
	\figlabel{RestartDetectIfNone}
\end{figure}

The \button{Into} and \button{Over} buttons give us two different ways to step through the execution.  If you click \button{Over}, \pharo executes the current message-send (in this case the \ct{do:}) in one step, unless there is an error.
So \button{Over} will take us to the next message-send in the current method, which is \ct{value}\,---\,this is exactly where we started, and not much help.
What we need to do is to find out why the \ct{do:} is not finding the character that we are looking for.

\dothis{After clicking \button{Over}, click \button{Restart} to get back to the situation shown in \figref{RestartDetectIfNone}.}

\dothis{Click \button{Into}; \pharo will go into the method corresponding to the highlighted message-send, in this case, \ct{Collection>>>do:}.}

However, it turns out that this is not much help either: we can be fairly confident that \ct{Collection>>>do:} is not broken.  The bug is much more likely to be in \emph{what} we asked \pharo to do.
\button{Through} is the appropriate button to use in this case: we want to ignore the details of the \ct{do:} itself and focus on the execution of the argument block.

\dothis{Select the \ct{detect:ifNone:} method again and \button{Restart} to get back to the state shown in \figref{RestartDetectIfNone}.
Now click on \button{Through} a few times.  Select \ct{each} in the context window as you do so.
You should see \ct{each} count down from \ct{10} as the \ct{do:} method executes.}

When \ct{each} is \ct{7} we expect the \ct{ifTrue:} block to be executed, but it isn't.
To see what is going wrong, go \button{Into} the execution of \ct{value:} as illustrated in \figref{steppingIntoValue}.

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{steppingIntoValue}}
		{\includegraphics[width=0.7\textwidth]{steppingIntoValue}}
	\end{center}
	\caption{The debugger after stepping \lct{Through} the \ct{do:} method several times.}
	\figlabel{steppingIntoValue}
\end{figure}

After clicking \button{Into}, we find ourselves in the position shown in \figref{dotIsAString}.
It looks at first that we have gone \emph{back} to the \ct{suffix} method, but this is because we are now executing the block that \ct{suffix} provided as argument to \ct{detect:}.
%\on{does not work any more! the debugger does not know about block variables!}
%If you select \ct{i} in the context inspector, you can see its current value, which should be \ct{7} if you have been following along.
%You can then select the corresponding element of \self from the \self{}-inspector.
%In  \figref{dotIsAString} you can see that element \ct{7} of the string is character 46, which is indeed a dot.
If you select \ct{dot} in the context inspector, you will see that its value is \ct{'.'}.
And now you see why they are not equal: the seventh character of \ct{'readme.txt'} is of course a \ct{Character}, while \ct{dot} is a \ct{String}.

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{dotIsAString}}
		{\includegraphics[width=0.7\textwidth]{dotIsAString}}
	\end{center}
	\caption{The debugger showing why \ct{'readme.txt' at: 7} is not equal to \ct{dot}}
	\figlabel{dotIsAString}
\end{figure}

Now that we see the bug, the fix is obvious: we have to convert \ct{dot} to a character before starting to search for it.

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{revertDialog}}
		{\includegraphics[width=0.7\textwidth]{revertDialog}}
	\end{center}
	\caption{Changing the \ct{suffix} method in the debugger: asking for confirmation of the exit from an inner block}
	\figlabel{revertDialog}
\end{figure}

\dothis{Change the code right in the debugger so that the assignment reads \ct{dot := FileDirectory dot first} and \menu{accept} the change.}

Because we are executing code inside a block that is inside a \lct{detect:}, several stack frames will have to be abandoned in order to make this change.  \pharo asks us if this is what we want (see \figref{revertDialog}), and, assuming that we click \menu{yes}, will save (and compile) the new method.

%\dothis{Click \button{Restart} and then \button{Proceed}; the debugger window will vanish, and the evaluation of the expression \ct{'readme.txt' suffix} will complete, and print the answer \ct{'.txt'}}

The evaluation of the expression \ct{'readme.txt' suffix} will complete, and print the answer \ct{'.txt'}.

Is the answer correct?  Unfortunately, we can't say for sure.  Should the suffix be \ct{.txt} or \ct{txt}?
The method comment in \ct{suffix} is not very precise.
The way to avoid this sort of problem is to write an \ind{SUnit} test that defines the answer.

\begin{method}[testSuffix]{A simple test for the \ct{suffix} method}
testSuffixFound
	self assert: 'readme.txt' suffix = 'txt'
\end{method}

The effort required to do that was little more than to run the same test in the workspace, but using \sunit saves the test as executable documentation, and makes it easy for others to run.
Moreover, if you add \mthref{testSuffix} to the class \ct{StringTest} and run that test suite with \sunit, you can very quickly get back to debugging the error.
\sunit opens the debugger on the failing assertion, but you need only go back down the stack one frame, \button{Restart} the test and go \button{Into} the \ct{suffix} method, and you can correct the error, as we are doing in \figref{fixOffByOne}.
It is then only  a second of work to click on the \button{Run Failures} button in the \sunit Test Runner, and confirm that the test now passes.

\begin{figure}[btp]
	\begin{center}
		\includegraphics[width=\textwidth]{fixOffByOne}
	\end{center}
	\caption{Changing the \ct{suffix} method in the debugger: fixing the off-by-one error after an \sunit assertion failure}
	\figlabel{fixOffByOne}
\end{figure}

Here is a better test:

\begin{method}[testSuffix2]{A better test for the \ct{suffix} method}
testSuffixFound
	self assert: 'readme.txt' suffix = 'txt'.
	self assert: 'read.me.txt' suffix = 'txt'
\end{method}
\noindent
Why is this test better?  Because it tells the reader what the method should do if there is more than one dot in the target String.

There are a few other ways to get into the debugger in addition to catching errors and assertion failures.
If you execute code that goes into an infinite loop, you can interrupt it and open a debugger on the computation by typing \short{.} (that's a full stop or a period, depending  on where you learned English).\footnote{It is also useful to know that you can bring up an emergency debugger at any time by typing \short{{\sc shift--}.}}
You can also just edit the suspect code to insert \ct{self halt}.
So, for example, we might edit the \ct{suffix} method to read as follows:
\index{process!interrupting}

\needspace{11ex}
\begin{method}[suffix]{Inserting a \ct{halt} into the \ct{suffix} method.}
suffix
	"assumes that I'm a file name, and answers my suffix, the part after the last dot"
	| dot dotPosition |
	dot := FileDirectory dot first.
	dotPosition := (self size to: 1 by: -1) detect: [ :i | (self at: i) = dot ].
	self halt.
	^ self copyFrom: dotPosition to: self size
\end{method}

When we run this method, the execution of the \ct{self halt} will bring up the \ind{pre-debugger}, from where we can proceed, or go into the debugger and look at variables, step the computation, and edit the code.

That's all there is to the debugger, but it's not all there is to the \ct{suffix} method.
The initial bug should have made you realize that if there is no dot in the target string, the \ct{suffix} method will raise an error.
This isn't the behaviour that we want, so let's add a second test to specify what should happen in this case.

\needlines{3}
\begin{method}[testNoSuffix]{A second test for the \ct{suffix} method: the target has no suffix}
testSuffixNotFound
	self assert: 'readme' suffix = ''
\end{method}

\needlines{2}
\dothis{Add \mthref{testNoSuffix} to the test suite in class \clsind{StringTest}, and watch the test raise an error.
Enter the debugger by selecting the erroneous test in \sunit, and edit the code so that the test passes.
The easiest and clearest way to do this is to replace the \ct{detect:} message by \ct{detect: ifNone:}, where  the second argument is a block that simply returns the string size.}

We will learn more about SUnit in \charef{SUnit}.

% section debugger (end)

%=========================================================
\section{The Process Browser}

\st is a multi-threaded system: there are many lightweight processes (also known as threads) running concurrently in your image.
In the future the \pharo virtual machine may take advantage of multiprocessors when they are available, but at present concurrency is implemented by time-slicing.

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{processBrowser}}
		{\includegraphics[width=0.7\textwidth]{processBrowser}}
	\end{center}
	\caption{The Process Browser}
	\figlabel{processBrowser}
\end{figure}

The process \subind{process}{browser} is a cousin of the debugger that lets you look at the various processes running inside \pharo.
\figref{processBrowser} shows a screenshot.
The top-left pane lists all of the processes in \pharo, in priority order, from the timer interrupt watcher at priority 80 to the idle process at priority 10.
Of course, on a uniprocessor, the only process that can be running when you look is the UI process; all others will be waiting for some kind of event.
%:===> Process browser context menu is broken!
\on{broken -- to be fixed!}
By default, the display of processes is static; it can be updated by \actclick{ing} and selecting \menu{turn on auto-update (a)}

If you select a process in the top-left pane, its stack trace is displayed in the top-right pane, just as with the debugger.
If you select a stack frame, the corresponding method is displayed in the bottom pane.
The process browser is not equipped with mini-inspectors for \self and \lct{thisContext}, but \actclick{ing} on the stack frames provide equivalent functionality.

%=========================================================
\section{Finding methods}
\seclabel{methodFinder}

There are two tools in \pharo to help you find messages.
They differ in both interface and functionality.

The \emph{method finder} was described at some length in \secref{quick:methodFinder}; you can use it to find methods by name or by functionality.
However, to look at the body of a method, the method finder opens a new browser.
This can quickly become overwhelming.

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{methodNamesRandom}}
		{\includegraphics[width=0.7\textwidth]{methodNamesRandom}}
	\end{center}
	\caption{The message names browser showing all methods containing the substring \ct{random} in their selectors.}
	\figlabel{methodNamesRandom} % should be *message* names!
\end{figure}

\index{message names browser}
The \emph{message names} browser has more limited search functionality: you type a fragment of a message selector in the search box, and the browser lists all methods that contain that fragment in their names, as shown in \figref{methodNamesRandom}.
However, it is a full-fledged browser:
if you select one of the names in the left pane, all of the methods with that name are listed in the right pane, and can be browsed in the bottom pane.
As with the browser, the message names browser has a button bar that can be used to open other  browsers on the selected method or its class.


% section methodFinder (end)

%=========================================================
\section{Change sets and the Change Sorter}
\seclabel{env:changeSet} % (fold)

Whenever you are working in \pharo, any changes that you make to methods and classes are recorded in a \ct{change set}.
This includes creating new classes, re-naming classes, changing categories, adding methods to existing classes\,---\,just about everything of significance.
However, arbitrary \emph{doits} are not included, so if, for example, you create a new global variable by assigning to it in a workspace, the variable creation will not make it into a \subind{file}{change set}.
\index{change sorter}

At any time, many change sets exist, but only one of them\,---\,\ct{ChangeSet current}\,---\,is collecting the changes that are being made to the image.
You can see which change set is current and can examine all of the change sets using the  change sorter, available by selecting \menu{World \go Tools \ldots \go Change Sorter}.

\begin{figure}[btp]
	\begin{center}
		\includegraphics[width=\linewidth]{changeSorter}
	\end{center}
	\caption{The Change Sorter}
	\figlabel{changeSorter}
\end{figure}

\figref{changeSorter} shows this browser.  The title bar shows which change set is current, and this change set is selected when the change sorter opens.

Other change sets can be selected in the top-left pane; the \actclick menu allows you to make a different change set current, or to create a new change set.
The next pane lists all of the classes affected by the selected change set (with their categories).
Selecting one of the classes displays the names of those of its methods that are also in the change set (\emph{not} all of the methods in the class) in the left central pane, and selecting a method name displays the method definition in the bottom pane.
Note that the change sorter does \emph{not} show you whether the creation of the class itself is part of the change set, although this information is stored in the object structure that is used to represent the change set.

The change sorter also lets you delete classes and methods from the change set using the \actclick menu on the corresponding items.
%  However, for more elaborate editing of change sets, you should use a second tool, the \textit{change sorter}, available by selecting \menu{World\go{}open \ldots \go{}dual change sorter}, which is shown in \figref{changeSorter}.
% The change sorter is essentially two change set browsers side by side; each side can focus on a different change set, class, or method.

The change sorter allows you to simultaneously view two change sets, one on the left hand side and the other on the right.
This layout supports the change sorter's main feature, which is the ability to move or copy changes from one change set to another, as shown by the \actclick menu in \figref{changeSorter}.
It is also possible to copy individual methods from one side to the other.

You may be wondering why you should care about the composition of a change set.
the answer is that change sets provide a simple mechanism for exporting code from \pharo to the file system, from where it can be imported into another \pharo image, or into another non-\pharo \st.
Change set export is known as ``filing-out'', and can be accomplished using the \actclick menu on any change set, class or method in either browser.
Repeated file outs create new versions of the file, but change sets are not a versioning tool like Monticello:
they do not keep track of dependencies.
\index{file!filing out}

Before the advent of Monticello, change sets were the main means for exchanging code between \pharo{}ers.
They have the advantage of simplicity (the file out is just a text file, although we \emph{don't} recommend that you try to edit them with a text editor), and a degree of portability.
%It's also quite easy to create a change set that makes changes to many different, unrelated parts of the system\,---\,something that Monticello is not yet equipped to do.
%\ab{Or is it?}
%\on{you mean something different than extensions to foreign packages using the *package protocol notation?}

The main drawback of change sets, compared to \ind{Monticello} packages, is that they do not support the notion of dependencies.
A filed-out change set is a set of \emph{actions} that change any image into which it is loaded. To successfully load a change set requires that the image be in an appropriate state.
For example, the change set might contain an action to add a method to a class; this can only be accomplished if the class is already defined in the image.
Similarly, the change set might rename or re-categorize a class, which obviously will only work if the class is present in the image; methods may use instance variables that were declared when they were filed out, but which do not exist in the image into which they are imported.
The problem is that change sets do not explicitly describe the conditions under which they can be filed in:
the file in process just hopes for the best, usually resulting in a cryptic error message and a stack trace when things go wrong.
Even if the file in works, one change set might silently undo a change made by another change set.

In contrast, Monticello packages represent code in a declarative fashion: they describe the state of the image should be in after they have been loaded.
This permits Monticello to warn you about conflicts (when two packages require contradictory final states)
and to offer to load a series of packages in dependency order.

In spite of these shortcomings, change sets still have their uses; in particular, you may find change sets on the Internet that you want to look at and perhaps use.
So, having filed out a change set using the change sorter, we will now tell you how to file one in.
This requires the use of another tool, the file list browser.

% section changeSet (end)

%=========================================================
\section{The File List Browser}

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{fileList}}
		{\includegraphics[width=0.7\textwidth]{fileList}}
	\end{center}
	\caption{A file list browser}
	\figlabel{fileList}
\end{figure}

The \ind{file list browser} is in fact a general-purpose tool for browsing the file system (and also FTP servers) from \pharo.
You can open it from the \menu{World\go{}Tools \ldots \go{}File Browser} menu.
What you see of course depends on the contents of your local file system, but a typical view is shown in \figref{fileList}.
\seeindex{file!browsing}{file list browser}

When you first open a file list browser it will be focussed on the current directory, that is, the one from which you started \pharo. The title bar shows the path to this directory.
The larger pane on the left-hand side can be used to navigate the file system in the conventional way.
When a directory is selected, the files that it contains (but not the directories) are displayed on the right.
This list of files can be filtered by entering a Unix-style pattern in the small box at the top-left of the window.
Initially, this pattern is \ct{*}, which matches all file names, but you can type a different string there and accept it, changing the pattern.  (Note that a \ct{*} is implicitly prepended and appended to the pattern that you type.)
The sort order of the files can be changes using the \button{name}, \button{date} and \button{size} buttons.
The rest of the buttons depend on the name of the file selected in the browser.
In \figref{fileList}, the file name has the suffix \ct{.cs}, so the browser assumes that it is a change set, and provides buttons to \button{install} it (which \textit{files it in} to a new change set whose name is derived from the name of the file),  to browse the \button{changes} in the file, to examine the \button{code} in the file,
and to \button{filein} the code into the \emph{current} change set.
You might think that the \button{conflicts} button would tell you about changes in the change set that conflicted with existing code in the image, but it doesn't.
\ab{Does anyone know what it does do?  I've never found it useful.}
\on{I tried it and found that it complained about linefeeds.}
Instead it just checks for potential problems in the file that might indicate that the file cannot properly be loaded (such as the presence of linefeeds).

\begin{figure}[btp]
	\begin{center}
	\ifluluelse
		{\includegraphics[width=\textwidth]{fileContentsBrowser}}
		{\includegraphics[width=0.7\textwidth]{fileContentsBrowser}}
	\end{center}
	\caption{A File Contents Browser}
	\figlabel{fileContentsBrowser}
\end{figure}

Because the choice of buttons to display depends on the file's \emph{name}, and not on its contents, sometimes the button that you want won't be on the screen.
However, the full set of options is always available from the \actclick \menu{more \ldots} menu, so
you can easily work around this problem.

The \button{code} button is perhaps the most useful for working with change sets; it opens a browser on the contents of the change set file; an example is shown in \figref{fileContentsBrowser}.
The file contents browser is similar to the browser except that it does not show categories, just classes, protocols and methods.
For each class, the browser will tell you whether the class already exists in the system and whether it is defined in the file (but \emph{not} whether the definitions are identical).
It will show the methods in each class, and (as shown in \figref{fileContentsBrowser}) will show you the differences between the current version and the version in the file.
Contextual menu items in each of the top four panes will also let you file in the whole of the change set, or the corresponding class, protocol or method.

%=========================================================
\section{In Smalltalk, you can't lose code}
\seclabel{cantLoseCode} % (fold)

It is quite possible to crash \pharo: as an experimental system, \pharo lets you change anything, including things that are vital to make \pharo work!

\dothis{To maliciously crash \pharo, try \ct{Object become: nil}.}

The good news is that you need never lose any work, even if you crash and go back to the last saved version of your image, which might be hours old.
This is because all of the code that you executed is saved in the \emph{.changes} file.
All of it!
This includes one liners that you evaluate in a workspace, as well as code that you add to a class while programming.
\index{changes}

So here are the instructions on how to get your code back.
There is no need to read this until you need it.
However, when you do need it, you'll find it here waiting for you.

In the worst case, you can use a text editor on the \emph{.changes} file, but since it is many megabytes in size, this can be slow and is not recommended.
\pharo offers you better ways.

%---------------------------------------------------------
\subsection{How to get your code back}
Restart \pharo from the most recent snapshot, and select \menu{World\go{}Tools \ldots \go{}Recover lost changes}.
%This will open a workspace full of useful expressions. The first three,

%\begin{code}{}
%Smalltalk recover: 10000.
%ChangeList browseRecentLog.
%ChangeList browseRecent: 2000.
%\end{code}

%\noindent
%are most useful for recovery.

% If you execute \ct{ChangeList browseRecentLog}, you will be given

This will give the opportunity to decide how far back in history you wish to browse.
Normally, it's sufficient to browse changes as far back as the last snapshot. (You can get much the same effect by editing \ct{ChangeList browseRecent: 2000} so that the number \ct{2000} becomes something else, using trial and error.)

One you have a \emph{recent changes} browser, showing, say, changes back as far as your last snapshot, you will have a list of everything that you have done to \pharo during that time.
You can delete items from this list using the \actclick menu.
When you are satisfied, you can file-in what is left, thus incorporating the changes into your new image.
It's a good idea to start a new change set, using the ordinary change set browser, before you do the file in, so that all of your recovered code will be in a new change set.
You can then file out this change set.

One useful thing to do in the \emph{recent changes} browser is to \menu{remove doIts}.
Usually, you won't want to file in (and thus re-execute) doIts.
However, there is an exception.
Creating a class shows up as a \menu{doIt}.
\emph{Before you can file in the methods for a class, the class must exist.}
So, if you have created any new classes, \emph{first} file-in the class creation doIts, then \menu{remove doIts} and file in the methods.
\lr{Maybe mention that class renames are not logged and completely screw up the change-set mechanism. (p. 174)}

When I am finished with the recovery, I like to file out my new change set, quit \pharo without saving the image, restart, and make sure that the new change set files back in cleanly.
% section cantLoseCode (end)

%=========================================================
\section{Chapter summary}

In order to develop effectively with \pharo, it is important to invest some effort into learning the tools available in the environment.

\begin{itemize}
  \item The standard \emph{browser} is your main interface for browsing existing categories, classes, method protocols and methods, and for defining new ones.
  The browser offers several useful buttons to directly jump to senders or implementors of a message, versions of a method, and so on.
  \item There exist several different browsers (such as the OmniBrowser and the Refactoring Browser), and several specialized browsers (such as the hierarchy browser) which provide different views of classes and methods.
  \item From any of the tools, you can highlight the name of a class or a method and immediately jump to a browser by using the keyboard shortcut \short{b}.
  \item You can also browse the \st system programmatically by sending messages to \ct{SystemNavigation default}.
  \item \emph{Monticello} is a tool for exporting, importing, versioning and sharing packages of classes and methods.
  A Monticello package consists of a category, subcategories, and related methods protocols in other categories.
  \item The \emph{inspector} and the \emph{explorer} are two tools that are useful for exploring and interacting with live objects in your image.
  You can even inspect tools by \metaclick{ing} to bring up their morphic halo and selecting the debug handle \debugHandle.
  \item The \emph{debugger} is a tool that not only lets you inspect the run-time stack of your program when an error is raised, but it also enables you to interact with all of the objects of your application, including the source code. In many cases you can modify your source code from the debugger and continue executing. The debugger is especially effective as a tool to support test-first development in tandem with SUnit (\charef{SUnit}).
  \item The \emph{process browser} lets you monitor, query and interact with the processes current running in your image.
  \item The \emph{method finder} and the \emph{message names browser} are two tools for locating methods. The first is more useful when you are not sure of the name, but you know the expected behaviour. The second offers a more advanced browsing interface when you know at least a fragment of the name.
  \item \emph{Change sets} are automatically generated logs of all changes to the source code of your image. They have largely been superseded by Monticello as a means to store and exchange versions of your source code, but are still useful, especially for recovering from catastrophic failures, however rare these may be.
  \item The \emph{file list browser} is a tool for browsing the file system. It also allows you to \menu{filein} source code from the file system.
  \item In case your image crashes before you could save it or backup your source code with Monticello, you can always recover your most recent changes using a \emph{change list browser}. You can then select the changes you want to replay and file them into the most recent copy of your image.
\end{itemize}

%=================================================================
\ifx\wholebook\relax\else\end{document}\fi
%=================================================================

%=========================================================
%---------------------------------------------------------
